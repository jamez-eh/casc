---
title: "Using basics of casc package"
author: "James Hopkins"
date: "February 2019"
package: "casc"
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{How to use casc}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warnings = FALSE,
  messages = FALSE,
  comment = "#>"
)
```

```{r}
suppressPackageStartupMessages({

    library(SingleCellExperiment)
    library(pROC)
    library(caret)
    library(scran)
    library(dplyr)
    library(SC3)
    library(foreach)
})
```


```{r}
simulate_clusters <- function(cluster_number= 5, cell_number = 1000, gene_number = 1000){
  cluster_size <- cell_number/cluster_number
  
  mat <- matrix(rep(0, cell_number*gene_number), ncol=cell_number, nrow=gene_number)
  
  for(i in 1:cluster_number){
    mat[((i-1)*cluster_size+1):((i-1)*cluster_size+10), ((i-1)*cluster_size+1):(i*cluster_size)] <- rnorm(cluster_size*10, mean=3, 0.5)
  }
  mat
}

logexp <- function(x){
  10^(x)-1
}
clusts <- simulate_clusters()
counts <- clusts

for(i in 1:dim(counts)[1]){
  for(j in 1:dim(counts)[2]){
    counts[i,j] <- logexp(counts[i,j])
  }
}

sce <- SingleCellExperiment(assays = list(logcounts = clusts, counts=counts))
rowData(sce)$feature_symbol <- stringi::stri_rand_strings(1000, 5)

```

# Overview


# Installation

Installation with `devtools` package via

```{r, eval=FALSE}
devtools::install_github("jamez-eh/casc")
```

 
# Basics

## Create SingleCellExperiment object
```{r}
data <- read.csv("/huntsman/huntsmansc/casc/data/simulation.csv")
data_mat <- as.matrix(data)
rownames(data_mat) <- data_mat[,1]
data_mat <- data_mat[,2:dim(data_mat)[2]]
data_mat <- t(data_mat)
num_mat <- apply(data_mat, 2, as.numeric)
rownames(num_mat) <- rownames(data_mat)
sce_sim <- SingleCellExperiment(assays = list(logcounts = num_mat))

rownames(sce_sim) <- stringi::stri_rand_strings(500, 5)
colnames(sce_sim) <- stringi::stri_rand_strings(1000, 5)
rowData(sce_sim)$feature_symbol <- rownames(sce_sim)

save(sce_sim, file= "/huntsman/huntsmansc/casc/data/sce_sim")
data(sce_sim)
```
## Clustering Data
```{r}
sce_sim <- sc3(sce_sim, ks = 2:15, svm_max = 15000, gene_filter = FALSE)
```


## Casc Useage
```{r}

# mc <- Mclust(reducedDims(sce_voa10819UT)[['PCA']][,1:2], G = 3)
# sce_voa10819UT$mc_cluster <- factor(mc$classification)

registerDoSEQ()

test_casc_list <- casc::cascer(sce_sim, list(sce_sim$sc3_10_clusters, sce_sim$sc3_3_clusters, sce_sim$sc3_5_clusters))
casc::aucPlot(test_casc_list)


casc::multROCPlot(test_casc_list$casc_clusters_1)
casc::multROCPlot(test_casc_list$casc_clusters_2)


```

# Technical

```{r}
sessionInfo()
```










